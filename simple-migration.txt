node -e "const{sequelize}=require('./config/database');const{QueryTypes}=require('sequelize');(async()=>{try{console.log('🔧 Starting migration...');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS transaction_number VARCHAR(20);');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS returns_breakdown JSONB;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS outright_breakdown JSONB;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS total_returns INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS total_load INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS load_6kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS load_13kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS load_50kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS cylinder_balance_6kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS cylinder_balance_13kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS cylinder_balance_50kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS cylinder_balance INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS financial_balance DECIMAL(10,2) DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS total_bill DECIMAL(10,2) DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS amount_paid DECIMAL(10,2) DEFAULT 0;');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS payment_method VARCHAR(20) DEFAULT \'cash\';');await sequelize.query('ALTER TABLE transactions ADD COLUMN IF NOT EXISTS notes TEXT;');await sequelize.query('ALTER TABLE customers ADD COLUMN IF NOT EXISTS financial_balance DECIMAL(10,2) DEFAULT 0;');await sequelize.query('ALTER TABLE customers ADD COLUMN IF NOT EXISTS cylinder_balance INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE customers ADD COLUMN IF NOT EXISTS cylinder_balance_6kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE customers ADD COLUMN IF NOT EXISTS cylinder_balance_13kg INTEGER DEFAULT 0;');await sequelize.query('ALTER TABLE customers ADD COLUMN IF NOT EXISTS cylinder_balance_50kg INTEGER DEFAULT 0;');try{await sequelize.query('CREATE UNIQUE INDEX IF NOT EXISTS transactions_transaction_number_unique ON transactions(transaction_number);');}catch(e){}const transactions=await sequelize.query('SELECT id FROM transactions WHERE transaction_number IS NULL ORDER BY id;',{type:QueryTypes.SELECT});for(let i=0;i<transactions.length;i++){const transactionNumber='A'+String(i+1).padStart(4,'0');await sequelize.query('UPDATE transactions SET transaction_number = ? WHERE id = ?;',{replacements:[transactionNumber,transactions[i].id],type:QueryTypes.UPDATE});}console.log('✅ Migration completed! Added',transactions.length,'transaction numbers');await sequelize.close();process.exit(0);}catch(error){console.error('❌ Migration failed:',error.message);await sequelize.close();process.exit(1);}})();" 